%
% @author Michal Koutný <michal@fykos.cz>
%
% @description Macros for unified insertion of figures into
%              page.
%               - full figures (whole width)
%               - illustration figures (1/3 of width), text is wrapped
%               - plots – like full figures, optimized for Gnuplot output
%
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{fksfigures}[2011/09/11 FYKOS figures manipulation]

\RequirePackage{graphicx}
\RequirePackage{wrapfig}
%\RequirePackage{color}
\RequirePackage{ifthen}
\RequirePackage[all]{hypcap} % links jump to an image, not the caption
\RequirePackage{optional}

\renewcommand\figurename{Obr.}
% paths to graphics
\newcommand{\@myinputpath}[1]{
\ifx\input@path\@undefined
\def\input@path{#1}
\else
\g@addto@macro{\input@path}{#1}
\fi
\graphicspath{#1}}

% @problemsdir must be somehow defined also here not to damage input@path functionality
\ifx\@problemsdir\@undefined
\def\@problemsdir{.}
\fi

\opt{web}{%
 \@myinputpath{{./graphics/color}{\@problemsdir/graphics/color}{./graphics/}{\@problemsdir/graphics/}} 
}\opt{print}{%
 \@myinputpath{{./graphics/}{\@problemsdir/graphics/}}
}

% commands for inserting figures syntax is command[position]{filename}{caption}{label}
\newcommand\fullfig[3]{%
\ifthenelse{\equal{#3}{}}{\capstartfalse}{}
\begin{figure}[h]
\centering
\includegraphics{#1}
\ifthenelse{\equal{#2}{}}{}{\caption{#2}}
\ifthenelse{\equal{#3}{}}{}{\label{#3}}
\end{figure}
\ifthenelse{\equal{#3}{}}{\capstarttrue}{}
\ignorespaces}

\newcommand\plotfig[4][h]{% filename is full, TODO (path)
\ifthenelse{\equal{#3}{}}{\capstartfalse}{}
\begin{figure}[#1]
\centering
  \opt{web}{%
  \input{color/#2}
  }\opt{print}{%
  \input{#2}}
\ifthenelse{\equal{#3}{}}{}{\caption{#3}}
\ifthenelse{\equal{#4}{}}{}{\label{#4}}
\end{figure}%
\ifthenelse{\equal{#3}{}}{\capstarttrue}{}%
\ignorespaces}

%specialized for third illustration figures
\newcommand\illfig[4][o]{%
\begin{wrapfigure}{#1}{0.35\textwidth}
  \centering
    \includegraphics[width=0.33\textwidth]{#2}
  \ifthenelse{\equal{#3}{}}{}{\caption{#3}}
  \ifthenelse{\equal{#4}{}}{}{\label{#4}}
\end{wrapfigure}\ignorespaces}

\AtBeginDocument{
  \renewcommand\figurename{Obr.}
}